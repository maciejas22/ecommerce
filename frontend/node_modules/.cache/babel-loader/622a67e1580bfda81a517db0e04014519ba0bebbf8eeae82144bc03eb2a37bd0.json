{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Maciej\\\\Desktop\\\\projekt_indywidualny\\\\shop\\\\frontend\\\\src\\\\context\\\\AuthProvider.jsx\",\n  _s = $RefreshSig$();\nimport { createContext, useState, useEffect } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport jwt_decode from \"jwt-decode\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext();\nexport default AuthContext;\nexport const AuthProvider = _ref => {\n  _s();\n  let {\n    children\n  } = _ref;\n  const [user, setUser] = useState(() => localStorage.getItem(\"authTokens\") ? jwt_decode(localStorage.getItem(\"authTokens\")) : null);\n  const [authTokens, setAuthTokens] = useState(() => localStorage.getItem(\"authTokens\") ? JSON.parse(localStorage.getItem(\"authTokens\")) : null);\n  const [isloggedIn, setIsloggedIn] = useState(() => localStorage.getItem(\"authTokens\") ? true : false);\n  const [loading, setLoading] = useState(true);\n  const navigate = useNavigate();\n  const registerUser = async e => {\n    e.preventDefault();\n    const respone = await fetch(\"http://localhost:8000/api/register/\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        first_name: e.target.first_name.value,\n        last_name: e.target.last_name.value,\n        username: e.target.username.value,\n        email: e.target.email.value,\n        password: e.target.password.value,\n        password2: e.target.password2.value\n      })\n    });\n    const data = await respone.json();\n    if (respone.status === 201) {\n      navigate(\"/login\");\n      window.location.reload();\n    } else {\n      console.log(data);\n      alert(data);\n    }\n  };\n  const loginUser = async e => {\n    e.preventDefault();\n    const respone = await fetch(\"http://localhost:8000/api/token/\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        username: e.target.username.value,\n        password: e.target.password.value\n      })\n    });\n    const data = await respone.json();\n    if (respone.status === 200) {\n      setAuthTokens(data);\n      setUser(jwt_decode(data.access));\n      localStorage.setItem(\"authTokens\", JSON.stringify(data));\n      navigate(\"/\");\n      window.location.reload();\n    } else {\n      alert(\"Invalid credentials\");\n    }\n  };\n  const logoutUser = () => {\n    setAuthTokens(null);\n    setUser(null);\n    localStorage.removeItem(\"authTokens\");\n    navigate(\"/\");\n    window.location.reload();\n  };\n  let updateTokens = async () => {\n    let response = await fetch(\"http://localhost:8000/api/token/refresh/\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        refresh: authTokens === null || authTokens === void 0 ? void 0 : authTokens.refresh\n      })\n    });\n    let data = await response.json();\n    if (response.status === 200) {\n      setAuthTokens(data);\n      setUser(jwt_decode(data.access));\n      localStorage.setItem(\"authTokens\", JSON.stringify(data));\n    } else {\n      logoutUser();\n    }\n  };\n  useEffect(() => {\n    const fourMinutes = 1000 * 60 * 4;\n    let interval = setInterval(() => {\n      if (authTokens) {\n        updateTokens();\n      }\n    }, fourMinutes);\n    return () => clearInterval(interval);\n  }, [authTokens]);\n  const contextData = {\n    isloggedIn: isloggedIn,\n    user: user,\n    authTokens: authTokens,\n    registerUser: registerUser,\n    loginUser: loginUser,\n    logoutUser: logoutUser\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: contextData,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 133,\n    columnNumber: 5\n  }, this);\n};\n_s(AuthProvider, \"elqo5xx9n2C0WB2dJhJNwIpvAOc=\", false, function () {\n  return [useNavigate];\n});\n_c = AuthProvider;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["createContext","useState","useEffect","useNavigate","jwt_decode","jsxDEV","_jsxDEV","AuthContext","AuthProvider","_ref","_s","children","user","setUser","localStorage","getItem","authTokens","setAuthTokens","JSON","parse","isloggedIn","setIsloggedIn","loading","setLoading","navigate","registerUser","e","preventDefault","respone","fetch","method","headers","body","stringify","first_name","target","value","last_name","username","email","password","password2","data","json","status","window","location","reload","console","log","alert","loginUser","access","setItem","logoutUser","removeItem","updateTokens","response","refresh","fourMinutes","interval","setInterval","clearInterval","contextData","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/Maciej/Desktop/projekt_indywidualny/shop/frontend/src/context/AuthProvider.jsx"],"sourcesContent":["import { createContext, useState, useEffect } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport jwt_decode from \"jwt-decode\";\r\n\r\nconst AuthContext = createContext();\r\n\r\nexport default AuthContext;\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [user, setUser] = useState(() =>\r\n    localStorage.getItem(\"authTokens\")\r\n      ? jwt_decode(localStorage.getItem(\"authTokens\"))\r\n      : null\r\n  );\r\n\r\n  const [authTokens, setAuthTokens] = useState(() =>\r\n    localStorage.getItem(\"authTokens\")\r\n      ? JSON.parse(localStorage.getItem(\"authTokens\"))\r\n      : null\r\n  );\r\n\r\n  const [isloggedIn, setIsloggedIn] = useState(() =>\r\n    localStorage.getItem(\"authTokens\") ? true : false\r\n  );\r\n\r\n  const [loading, setLoading] = useState(true);\r\n  const navigate = useNavigate();\r\n\r\n  const registerUser = async (e) => {\r\n    e.preventDefault();\r\n    const respone = await fetch(\"http://localhost:8000/api/register/\", {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n      body: JSON.stringify({\r\n        first_name: e.target.first_name.value,\r\n        last_name: e.target.last_name.value,\r\n        username: e.target.username.value,\r\n        email: e.target.email.value,\r\n        password: e.target.password.value,\r\n        password2: e.target.password2.value,\r\n      }),\r\n    });\r\n    const data = await respone.json();\r\n\r\n    if (respone.status === 201) {\r\n      navigate(\"/login\");\r\n      window.location.reload();\r\n    } else {\r\n      console.log(data);\r\n      alert(data);\r\n    }\r\n  };\r\n\r\n  const loginUser = async (e) => {\r\n    e.preventDefault();\r\n    const respone = await fetch(\"http://localhost:8000/api/token/\", {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n      body: JSON.stringify({\r\n        username: e.target.username.value,\r\n        password: e.target.password.value,\r\n      }),\r\n    });\r\n    const data = await respone.json();\r\n\r\n    if (respone.status === 200) {\r\n      setAuthTokens(data);\r\n      setUser(jwt_decode(data.access));\r\n      localStorage.setItem(\"authTokens\", JSON.stringify(data));\r\n\r\n      navigate(\"/\");\r\n      window.location.reload();\r\n    } else {\r\n      alert(\"Invalid credentials\");\r\n    }\r\n  };\r\n\r\n  const logoutUser = () => {\r\n    setAuthTokens(null);\r\n    setUser(null);\r\n    localStorage.removeItem(\"authTokens\");\r\n\r\n    navigate(\"/\");\r\n    window.location.reload();\r\n  };\r\n\r\n  let updateTokens = async () => {\r\n    let response = await fetch(\"http://localhost:8000/api/token/refresh/\", {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n      body: JSON.stringify({\r\n        refresh: authTokens?.refresh,\r\n      }),\r\n    });\r\n    let data = await response.json();\r\n\r\n    if (response.status === 200) {\r\n      setAuthTokens(data);\r\n      setUser(jwt_decode(data.access));\r\n      localStorage.setItem(\"authTokens\", JSON.stringify(data));\r\n    } else {\r\n      logoutUser();\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    const fourMinutes = 1000 * 60 * 4;\r\n    let interval = setInterval(() => {\r\n      if (authTokens) {\r\n        updateTokens();\r\n      }\r\n    }, fourMinutes);\r\n    return () => clearInterval(interval);\r\n  }, [authTokens]);\r\n\r\n  const contextData = {\r\n    isloggedIn: isloggedIn,\r\n    user: user,\r\n    authTokens: authTokens,\r\n\r\n    registerUser: registerUser,\r\n    loginUser: loginUser,\r\n    logoutUser: logoutUser,\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={contextData}>{children}</AuthContext.Provider>\r\n  );\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}